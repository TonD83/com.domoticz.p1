<style type="text/css">
	.input-wrap {
		position: relative;
	}
	.fa {
		position: absolute;
		margin-left: 5px;
		margin-top: 7px;

		opacity: 0;
		visibility: hidden;
		transition: all 0.3s;
	}
	.fa.visible {
		opacity: 1;
		visibility: visible;
	}
	.form-group input[type="text"] {
		width: 160px;
	}
</style>

<p class="form-group">
	<label for="address"><span data-i18n="pair.title"></span></label>

	<span class="input-wrap">
		<input type="text" id="sip" placeholder="IP address (e.g. 10.0.0.5)" value="" />
	</span>
	<span class="input-wrap">
		<input type="text" id="sid" placeholder="Smile ID (e.g. bcdfghjk)" value="" />


	<button class="button" id="validate">Connect</button>
	<i class="smile-status smile-loading fa fa-circle-o-notch fa-spin"></i>
	<i class="smile-status smile-ok fa fa-check" style="color: #96ff00;"></i>
	<i class="smile-status smile-err fa fa-times" style="color: #ff6300;"></i>

</p>
<p class="smile-err-msg" style="color: #ff6300;">
</p>

<script type="text/javascript">

$(function(){
	$('#validate').click(function(){

		var smileIp = $('#sip').val();
		var smileId = $('#sid').val();

		$('.smile-status').removeClass('visible');
		$('.smile-loading').addClass('visible');

		Homey.emit('validate', {
			smileIp: smileIp,
			smileId: smileId,
			}, function( err, result ){

			$('.smile-status').removeClass('visible');
			if(!err) {
				$('.smile-ok').addClass('visible');
				$('.smile-err-msg').html('');

				var data_init = {
					id: smileId,
					name: "Smile_"+smileId,
					smileIp: smileIp,
					smileId: smileId,
					readings: result
				};

				Homey.addDevice({
					name	: "Smile_"+smileId,
					data	: data_init,
					capabilities: [
									"measure_power",
									"meter_power",
									"meter_gas",
	/*								{
						        "id": "offpeak",
						        "type": "boolean",
						        "title": {
						          "en": "off-peak",
						          "nl": "laag tarief"
						        },
						        "desc": {
						          "en": "Is off-peak tarriff active?",
						          "nl": "Is laag tarief actief?"
						        },
						        "getable": true,
						        "setable": false
						      } */
								]
				}, function( err, result ){
					if( err ) return Homey.alert(err.message || err.toString());
					Homey.emit('add_device', data_init, function( err, result ){
						if( err ) return Homey.alert(err.message || err.toString());
						Homey.done();
					})
				})
			} else {
				$('.smile-err').addClass('visible');
				$('.smile-err-msg').html( err.message || err.toString() );
			}
		})

	});
})

</script>

</script>
